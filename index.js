const r=React,rd=ReactDOM,e=r.createElement;function App(){const t=covidFilters.groupByCountry.defaultValue,o=covidFilters.selectedTypes.defaultValue,a=covidFilters.selectedRegions.defaultValue,s=covidFilters.useLogScale.defaultValue,c=covidFilters.countrySearchQuery.defaultValue,l=covidFilters.dataSort.defaultValue,i=covidFilters.dataSortDirection.defaultValue,[n,d]=r.useState(null),[u,y]=r.useState(null),[m,v]=r.useState(null),[p,k]=r.useState(t),[h,g]=r.useState(o),[f,S]=r.useState(a),[b,C]=r.useState(s),[D,T]=r.useState(c),[N,F]=r.useState(l),[R,x]=r.useState(i);if(r.useEffect(()=>{loadCovidData().then(e=>{d(e),y(groupCovidDataByCountries(e))}).catch(()=>v("Cannot fetch the statistics data. It might be a network issue. Try to refresh the page."))},[]),r.useEffect(()=>{const e=filtersFromUrl();e.hasOwnProperty(covidFilters.groupByCountry.key)&&k(e[covidFilters.groupByCountry.key]),e.hasOwnProperty(covidFilters.useLogScale.key)&&C(e[covidFilters.useLogScale.key]),e.hasOwnProperty(covidFilters.selectedTypes.key)&&g(e[covidFilters.selectedTypes.key]),e.hasOwnProperty(covidFilters.selectedRegions.key)&&S(e[covidFilters.selectedRegions.key]),e.hasOwnProperty(covidFilters.dataSort.key)&&F(e[covidFilters.dataSort.key]),e.hasOwnProperty(covidFilters.dataSortDirection.key)&&x(e[covidFilters.dataSortDirection.key])},[]),m)return e(ErrorMessage,{errorMessage:m});if(!n||!u)return e(Spinner);const L=p?u:n;return e("div",null,e("div",{className:"mb-2"},e(LastUpdatedDate,{covidData:n})),e("div",{className:"mb-1"},e(DataTypes,{covidData:L,selectedRegions:f,selectedTypes:h,onTypeChange:e=>{let t;t=h.includes(e)?[...h.filter(t=>t!==e)]:[...h,e],g(t),filterToUrl(covidFilters.selectedTypes.key,t)}})),e("div",{className:"mb-4"},e(CovidChart,{covidData:L,regions:f,selectedTypes:h,useLogScale:b})),e("div",{className:"mb-0"},e(TableFilters,{onFiltersReset:()=>{k(t),g(o),S(a),C(s),T(c),F(l),x(i),deleteFiltersFromUrl()},groupByCountry:p,onGroupByCountries:()=>{const e=!p;S(a),k(e),filterToUrl(covidFilters.groupByCountry.key,e),filterToUrl(covidFilters.selectedRegions.key,a)},countrySearchQuery:D,onCountrySearch:e=>{T(e||"")},useLogScale:b,onUseLogScale:e=>{C(e),filterToUrl(covidFilters.useLogScale.key,e)}})),e("div",{className:"mb-4"},e(RegionsTable,{groupByCountry:p,covidData:L,selectedRegions:f,onRegionChange:e=>{let t;f.includes(e)?(t=[...f.filter(t=>t!==e)]).length||(t=[covidCountries.all.key]):t=[...f.filter(e=>e!==covidCountries.all.key),e],S(t),filterToUrl(covidFilters.selectedRegions.key,t)},countrySearchQuery:D,dataSort:N,dataSortDirection:R,onDataSort:(e,t)=>{F(e),x(t),filterToUrl(covidFilters.dataSort.key,e),filterToUrl(covidFilters.dataSortDirection.key,t)}})))}function LastUpdatedDate({covidData:t}){const r=getLastUpdatedDate(t);return e("small",{className:"text-muted"},"Last updated: ",e("span",{className:"badge badge-dark"},r))}function DataTypes({covidData:t,selectedRegions:r,selectedTypes:o,onTypeChange:a}){const s=Object.values(covidDataTypes).map(s=>{const c=!!o.includes(s.key);return e(DataType,{key:s.key,covidData:t,selectedRegions:r,dataType:s,checked:c,onTypeChange:a})});return e("form",{className:"form-inline"},s)}function DataType({covidData:t,selectedRegions:r,dataType:o,checked:a,onTypeChange:s}){const c=covidDataTypes[o.key].alertClass,l=covidDataTypes[o.key].badgeClass,i=getTotalCount(t,o.key,r);return e("label",{className:`alert ${c} mr-3 mb-3`},e("div",{className:"form-group form-check mb-0"},e("input",{type:"checkbox",className:"form-check-input",checked:a,onChange:()=>{s(o.key)}}),e("div",{className:"form-check-label"},o.title,e("span",{className:`badge ${l} ml-2`},i.toLocaleString()))))}function CovidChart({covidData:t,regions:o,selectedTypes:a,useLogScale:s}){const c=r.useRef(null),l=r.useRef(null),[i,n]=useWindowSize();let d=1;return i>450&&i<=700?d=2:i>700&&i<=1e3?d=3:i>1e3&&(d=4),r.useEffect(()=>{if(!c.current)return;const e=t.labels.slice(covidSchema.dateStartColumn).map(formatDateLabel),r=s?"logYAxis":"linearYAxis",i=[];o.forEach((e,o)=>{a.forEach(a=>{let s=[];if(e===covidCountries.all.key)s=getGlobalTicks(t,a);else{const r=getRegionIndexByKey(t,a,e);r>=0&&(s=t.ticks[a][r])}const c=covidDataTypes[a].borderColor.length,l={label:`${covidDataTypes[a].title} (${e})`,data:s.slice(covidSchema.dateStartColumn),borderWidth:1,borderColor:covidDataTypes[a].borderColor[o%c],fill:!1,yAxisID:r};i.push(l)})}),l.current&&l.current.destroy();const n=c.current.getContext("2d");l.current=new Chart(n,{type:"line",data:{labels:e,datasets:i},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:d,scales:{yAxes:[{id:"linearYAxis",type:"linear",display:"auto",ticks:{callback:(e,t,r)=>e.toLocaleString()}},{id:"logYAxis",type:"logarithmic",display:"auto",ticks:{}}]}}})},[s,a,o,d]),e("canvas",{ref:c},"Your browser does not support the canvas element.")}function TableFilters({onFiltersReset:t,groupByCountry:r,onGroupByCountries:o,countrySearchQuery:a,onCountrySearch:s,useLogScale:c,onUseLogScale:l}){return e("form",{className:"form-inline"},e("div",{className:"form-group mr-3 mb-2"},e(CountrySearch,{countrySearchQuery:a,onCountrySearch:s})),e("div",{className:"form-group form-check mr-3 mb-2"},e(Toggle,{checked:r,onChange:o,text:"Group by countries"})),e("div",{className:"form-group form-check mr-3 mb-2"},e(Toggle,{text:"Logarithmic scale",onChange:l,checked:c})),e("button",{className:"btn btn-dark mb-2",onClick:e=>{e.preventDefault(),t()}},e("i",{className:"fas fa-trash-alt mr-2"}),"Reset Filters"))}function CountrySearch({countrySearchQuery:t,onCountrySearch:r}){return e("input",{type:"search",className:"form-control",placeholder:"Search country",onChange:e=>r(e.target.value),value:t})}function RegionsTable({groupByCountry:t,covidData:r,selectedRegions:o,onRegionChange:a,countrySearchQuery:s,dataSort:c,dataSortDirection:l,onDataSort:i}){const n=e=>{if(e===c){const t=l===covidSortDirections.asc.key?covidSortDirections.desc.key:covidSortDirections.asc.key;i(e,t)}else i(e,l)},d=e("thead",{className:"thead-dark"},e("tr",null,e("th",null,""),e("th",null,""),e("th",{sortable:"sortable",onClick:()=>n(covidSorts.country.key)},t?"Countries":"Regions",e(ColumnSorter,{sortDirection:c===covidSorts.country.key?l:null})),e("th",{sortable:"sortable",onClick:()=>n(covidSorts.confirmed.key)},covidDataTypes.confirmed.title,e(ColumnSorter,{sortDirection:c===covidSorts.confirmed.key?l:null})),e("th",{sortable:"sortable",onClick:()=>n(covidSorts.recovered.key)},covidDataTypes.recovered.title,e(ColumnSorter,{sortDirection:c===covidSorts.recovered.key?l:null})),e("th",{sortable:"sortable",onClick:()=>n(covidSorts.deaths.key)},covidDataTypes.deaths.title,e(ColumnSorter,{sortDirection:c===covidSorts.deaths.key?l:null})),e("th",{sortable:"sortable",onClick:()=>n(covidSorts.mortality.key)},"Mortality",e(ColumnSorter,{sortDirection:c===covidSorts.mortality.key?l:null})))),u=getCovidRegions(r).filter(e=>{if(!s)return!0;const t=escapeRegExp(s.trim());return e.key.search(new RegExp(t,"i"))>=0}).sort((e,t)=>{let r,o;switch(c){case covidSorts.country.key:r=e.key,o=t.key;break;case covidSorts.mortality.key:r=calculateMortality(e.numbers[covidDataTypes.confirmed.key],e.numbers[covidDataTypes.deaths.key]),o=calculateMortality(t.numbers[covidDataTypes.confirmed.key],t.numbers[covidDataTypes.deaths.key]);break;default:r=e.numbers[covidSorts[c].dataKey],o=t.numbers[covidSorts[c].dataKey]}return r===o?0:r>o?l===covidSortDirections.desc.key?-1:1:l===covidSortDirections.desc.key?1:-1}).map((t,r)=>{const s=!!o.includes(t.key),c=t.numbers[covidDataTypes.confirmed.key]>=0?t.numbers[covidDataTypes.confirmed.key]:"",l=t.numbers[covidDataTypes.recovered.key]>=0?t.numbers[covidDataTypes.recovered.key]:"",i=t.numbers[covidDataTypes.deaths.key]>=0?t.numbers[covidDataTypes.deaths.key]:"";let n=`${calculateMortality(t.numbers[covidDataTypes.confirmed.key],t.numbers[covidDataTypes.deaths.key])}%`;return e("tr",{key:t.key,onClick:()=>a(t.key)},e("td",null,e("input",{type:"checkbox",checked:s,onChange:()=>{}})),e("td",null,e("small",{className:"text-muted"},`#${r+1}`)),e("td",null,t.key),e("td",null,c),e("td",null,l),e("td",null,i),e("td",null,e("small",{className:"text-muted"},n)))}),y=e("tbody",null,u);return e("div",null,e("div",{className:"table-responsive covid-data-table-wrapper"},e("table",{className:"table table-hover"},d,y)),e("small",{className:"text-muted"},"* Table is scrollable"))}function ColumnSorter({sortDirection:t}){const r=t?"ml-2":"ml-2 text-muted";let o=null;return o=t?t===covidSortDirections.asc.key?e("i",{className:"fas fa-sort-up"}):e("i",{className:"fas fa-sort-down"}):e("i",{className:"fas fa-sort"}),e("span",{className:r},o)}function ErrorMessage({errorMessage:t}){return e("div",{className:"alert alert-danger"},t)}function Spinner(){return e("div",{className:"d-flex justify-content-center mt-5 mb-5"},e("div",{className:"spinner-border"}))}function Toggle({text:t,checked:r,onChange:o}){return e("label",{},e("div",{className:"form-group form-check mb-0"},e("input",{type:"checkbox",checked:r,className:"form-check-input",onChange:e=>o(e.target.checked)}),e("div",{className:"form-check-label"},t)))}document.addEventListener("DOMContentLoaded",()=>{rd.render(e(App),document.getElementById("root"))});